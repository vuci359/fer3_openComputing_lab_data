<!DOCTYPE html>
<head>
    <meta charset="UTF-8"/>
    <link rel="stylesheet" href="./jquery.dataTables.min.css" />
    <script type="text/javascript" charset="utf8" src="./jquery.min.js"></script>
    <script type="text/javascript" charset="utf8" src="./jquery.dataTables.min.js"></script>
    <script type="text/javascript" charset="utf8" src="./dataTables.buttons.min.js"></script>
    <script type="text/javascript" charset="utf8" src="./buttons.html5.min.js"></script>



</head>
<body>
    <h1>Datatable</h1>
    <table id="tablica" class="display">
        <thead>
            <tr>
                <th>song name</th>
                <th>band name</th>
                <th>band members</th>
                <th>genre</th>
                <th>album name</th>
                <th>album label</th>
                <th>album release date</th>
                <th>song length</th>
                <th>position on album</th>
                <th>lyrics writers</th>
                <th>music writers</th>
                <th>lyrics</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <a href="./index.html">Index</a>
</body>


<script>
var json_data = null;
var data_table = $('#tablica').DataTable({
        "data": null,
        "columns": [
            { "data": "song name" },
            { "data": "band name" },
            { "data": "band members" },
            { "data": "genre" },
            { "data": "album name" },
            { "data": "album label" },
            { "data": "album release date" },
            { "data": "song length" },
            { "data": "position on album" },
            { "data": "lyrics writers" },
            { "data": "music writers" },
            { "data": "lyrics" }
        ],
        dom: 'Bfrtip',
        buttons: [
            {
                text: 'Preuzmi JSON',
                id:"get_json",
                action: function ( e, dt, button, config ) {
                    var data = dt.buttons.exportData();
                    console.log(data);
                    $.fn.dataTable.fileSave(
                        new Blob( [ JSON.stringify( data ) ] ),
                        'Export.json'
                    );
                }
                
            },
            {
                text: 'Preuzmi CSV',
                id:"get_csv",
                exportOptions: {
                modifier: {
                    search: 'none'
                }
            }
            }
        ]
    });

//punjenje tablice
async function fill_table(){
    //učitavanje podataka
    await getData();
    //punjenje tablice
    data_table.clear();
    data_table.rows.add(json_data.podaci).draw();
}




// output: {"success":"true"}
async function getData(){
      
         return await fetch('http://localhost:8087' + '/api/HeavyMetalData/GetData',{
            method: 'GET',
            mode:'cors',
            headers:{
                'Access-Control-Allow-Origin': 'true',
                'Sec-Fetch-Mode': 'cors'
            },
            data: jQuery.param({stupac:"music writers", parameter:"James Hetfield"}),
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8'
        }).then(response => {
             if (response.status >= 200 && response.status < 300) {
               // console.log("aaa");
             //   console.log(response.body);
              //  console.log("bbb");
                return response;
            } else {
                console.log('Something happened wrong');
                console.log(response.body);
               }
         }).then(res => res.json()).then(data => {
              //  console.log("zzz");
               //console.log(data);
                json_data = data;
         }).catch(err => err);
}

fill_table();
</script>